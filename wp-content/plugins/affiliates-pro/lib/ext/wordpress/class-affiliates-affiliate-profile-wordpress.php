<?php
class Affiliates_Affiliate_Profile_WordPress extends Affiliates_Affiliate_Profile { const IXAP174 = 'affiliate-profile-nonce'; const IXAP383 = 'edit-profile'; static function init() { add_shortcode( 'affiliates_affiliate_profile', array( __CLASS__, 'profile_shortcode' ) ); } static function profile_shortcode( $IXAP205, $IXAP156 = null ) { $IXAP15 = null; $IXAP101 = shortcode_atts( self::$IXAP171, $IXAP205 ); return self::render_profile( $IXAP101 ); } static function render_profile( $IXAP101 = array() ) { global $affiliates_options, $affiliates_db; wp_enqueue_style( 'affiliates' ); $IXAP58 = ''; $IXAP38 = Affiliates_Affiliate_WordPress::get_user_affiliate_id(); if ( $IXAP38 === false ) { return $IXAP58; } $IXAP328 = Affiliates_Affiliate_WordPress::get_affiliate( $IXAP38 ); $IXAP384 = isset( $IXAP101['show_name'] ) ? $IXAP101['show_name'] : self::$IXAP171['show_name']; $IXAP385 = $IXAP384 && isset( $IXAP101['edit_name'] ) ? $IXAP101['edit_name'] : self::$IXAP171['edit_name']; $IXAP386 = isset( $IXAP101['show_email'] ) ? $IXAP101['show_email'] : self::$IXAP171['show_email']; $IXAP387 = $IXAP386 && isset( $IXAP101['edit_email'] ) ? $IXAP101['edit_email'] : self::$IXAP171['edit_email']; $IXAP388 = isset( $IXAP101['show_attributes'] ) ? $IXAP101['show_attributes'] : self::$IXAP171['show_attributes']; if ( $IXAP388 ) { $IXAP388 = explode( ",", $IXAP388 ); $IXAP389 = array(); foreach ( $IXAP388 as $IXAP372 ) { $IXAP372 = trim( $IXAP372 ); if ( Affiliates_Attributes::validate_key( $IXAP372 ) ) { $IXAP389[] = $IXAP372; } } $IXAP388 = $IXAP389; } else { $IXAP388 = array(); } $IXAP390 = isset( $IXAP101['edit_attributes'] ) ? $IXAP101['edit_attributes'] : self::$IXAP171['edit_attributes']; if ( $IXAP390 ) { $IXAP389 = explode( ",", $IXAP390 ); $IXAP390 = array(); foreach ( $IXAP389 as $IXAP372 ) { if ( in_array( $IXAP372, $IXAP388 ) ) { $IXAP390[] = $IXAP372; } } } else { $IXAP390 = array(); } if ( isset( $_POST[self::IXAP174] ) ) { if ( !wp_verify_nonce( $_POST[self::IXAP174], self::IXAP383 ) ) { wp_die( __( 'Access denied.', AFFILIATES_PRO_PLUGIN_DOMAIN ) ); } if ( $IXAP385 && isset( $_POST['first_name'] ) && ( $_POST['last_name'] ) ) { $IXAP39 = $_POST['first_name'] . " " . $_POST['last_name']; if ( $IXAP328->name != $IXAP39 ) { if ( $IXAP9 = Affiliates_Affiliate_WordPress::get_affiliate_user_id( $IXAP38 ) ) { if ( $IXAP391 = Affiliates_Utility::filter( $_POST['first_name'] ) ) { update_user_meta( $IXAP9, 'first_name', $IXAP391 ); } if ( $IXAP392 = Affiliates_Utility::filter( $_POST['last_name'] ) ) { update_user_meta( $IXAP9, 'last_name', $IXAP392 ); } } Affiliates_Affiliate_WordPress::update_name( $IXAP38, $IXAP39 ); } } if ( $IXAP387 && isset( $_POST['affiliate_email'] ) && ( $_POST['affiliate_email'] != $IXAP328->email ) ) { if ( ( $IXAP393 = Affiliates_Validator::validate_email( $_POST['affiliate_email'] ) ) && !email_exists( $IXAP393 ) ) { if ( $IXAP393 = Affiliates_Affiliate_WordPress::update_email( $IXAP38, $IXAP393 ) ) { if ( $IXAP9 = Affiliates_Affiliate_WordPress::get_affiliate_user_id( $IXAP38 ) ) { $IXAP394 = array( 'ID' => $IXAP9, 'user_email' => $IXAP393 ); wp_update_user( $IXAP394 ); } } } } foreach ( $IXAP390 as $IXAP372 ) { $IXAP395 = "aff_attr_" . $IXAP372; if ( isset( $_POST[$IXAP395] ) ) { Affiliates_Affiliate_WordPress::update_attribute( $IXAP38, $IXAP372, $_POST[$IXAP395] ); } } } $IXAP328 = Affiliates_Affiliate_WordPress::get_affiliate( $IXAP38 ); $IXAP58 .= '<div class="affiliate-profile">' . '<form id="affiliate-profile" action="" method="post">'; if ( $IXAP384 ) { $IXAP396 = !$IXAP385 ? ' readonly="readonly" ' : ''; if ( $IXAP9 = Affiliates_Affiliate_WordPress::get_affiliate_user_id( $IXAP38 ) ) { $IXAP391 = get_user_meta( $IXAP9, 'first_name', true ); $IXAP392 = get_user_meta( $IXAP9, 'last_name', true ); } else { $IXAP391 = ''; $IXAP392 = ''; } $IXAP58 .= '<div class="field first-name">' . '<label for="first_name">' . __( 'First Name', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</label>' . '<input ' . $IXAP396 . ' name="first_name" type="text" value="' . esc_attr( $IXAP391 ) . '"/>'. '</div>'; $IXAP58 .= '<div class="field last-name">' . '<label for="last_name">' . __( 'Last Name', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</label>' . '<input ' . $IXAP396 . ' name="last_name" type="text" value="' . esc_attr( $IXAP392 ) . '"/>'. '</div>'; } if ( $IXAP386 ) { $IXAP396 = !$IXAP387 ? ' readonly="readonly" ' : ''; $IXAP58 .= '<div class="field affiliate-email">' . '<label for="affiliate_email">' . __( 'Email', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</label>' . '<input ' . $IXAP396 . ' name="affiliate_email" type="text" value="' . esc_attr( $IXAP328->email ) . '"/>'. '</div>'; } if ( $IXAP388 ) { $IXAP94 = $affiliates_db->get_tablename( 'affiliates_attributes' ); $IXAP397 = $affiliates_db->get_objects( "SELECT * FROM $IXAP94 WHERE affiliate_id = %d", $IXAP38 ); $IXAP258 = array(); foreach ( $IXAP397 as $IXAP372 ) { $IXAP258[$IXAP372->attr_key] = $IXAP372->attr_value; } $IXAP398 = Affiliates_Attributes::get_keys(); foreach ( $IXAP388 as $IXAP332 ) { $IXAP333 = isset( $IXAP258[$IXAP332] ) ? $IXAP258[$IXAP332] : ''; $IXAP396 = !in_array( $IXAP332, $IXAP390 ) ? ' readonly="readonly" ' : ''; $IXAP395 = "aff_attr_" . $IXAP332; $IXAP58 .= '<div class="field affiliate-attribute ' . esc_attr( $IXAP332 ) . '">' . '<label for="' . esc_attr( $IXAP395 ) . '">' . __( $IXAP398[$IXAP332], AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</label>' . '<input ' . $IXAP396 . ' name="' . esc_attr( $IXAP395 ) . '" type="text" value="' . esc_attr( $IXAP333 ) . '"/>'. '</div>'; } } if ( $IXAP385 || $IXAP387 || $IXAP390 ) { $IXAP58 .= '<div class="submit">' . wp_nonce_field( self::IXAP383, self::IXAP174, true, false ) . '<input type="submit" value="' . __( 'Save', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '"/>' . '<input type="hidden" value="submitted" name="submitted"/>' . '</div>'; } $IXAP58 .= '</form>'; $IXAP58 .= '</div>'; return $IXAP58; } } Affiliates_Affiliate_Profile_WordPress::init();