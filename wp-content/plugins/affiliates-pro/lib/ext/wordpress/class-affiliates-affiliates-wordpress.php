<?php
class Affiliates_Affiliates_WordPress extends Affiliates_Affiliates { function view() { global $wpdb, $wp_rewrite, $affiliates_options; global $affiliates_db; $IXAP58 = ''; $IXAP97 = date( 'Y-m-d', time() ); $IXAP147 = get_option( 'aff_pname', AFFILIATES_PNAME ); if ( !current_user_can( AFFILIATES_ADMINISTER_AFFILIATES ) ) { wp_die( __( 'Access denied.', AFFILIATES_PRO_PLUGIN_DOMAIN ) ); } if ( isset( $_POST['action'] ) ) { switch( $_POST['action'] ) { case 'add' : if ( !affiliates_admin_affiliates_add_submit() ) { return affiliates_admin_affiliates_add(); } break; case 'edit' : $IXAP324 = new Affiliates_Affiliate_WordPress(); if ( !$IXAP324->edit_submit() ) { return $IXAP324->edit( $_POST['affiliate-id-field'] ); } break; case 'remove' : affiliates_admin_affiliates_remove_submit(); break; case 'add-attribute' : $IXAP325 = new Affiliates_Attributes_WordPress(); if ( !$IXAP325->add_submit() ) { if ( isset( $_POST['affiliate_id'] ) ) { return $IXAP325->add( $_POST['affiliate_id' ] ); } } else { $IXAP324 = new Affiliates_Affiliate_WordPress(); return $IXAP324->edit( $_POST['affiliate_id'] ); } break; case 'edit-attribute' : $IXAP325 = new Affiliates_Attributes_WordPress(); if ( !$IXAP325->edit_submit() ) { if ( isset( $_POST['affiliate_id'] ) && isset( $_GET['attr_key'] ) ) { return $IXAP325->edit( $_POST['affiliate_id' ], $_GET['attr_key'] ); } } else { $IXAP324 = new Affiliates_Affiliate_WordPress(); return $IXAP324->edit( $_POST['affiliate_id'] ); } break; case 'remove-attribute' : $IXAP325 = new Affiliates_Attributes_WordPress(); $IXAP325->remove_submit(); $IXAP324 = new Affiliates_Affiliate_WordPress(); return $IXAP324->edit( $_POST['affiliate_id'] ); break; case 'add-relation' : break; case 'edit-relation' : break; case 'remove-relation' : break; } } else if ( isset ( $_GET['action'] ) ) { switch( $_GET['action'] ) { case 'add' : return affiliates_admin_affiliates_add(); break; case 'edit' : if ( isset( $_GET['affiliate_id'] ) ) { $IXAP324 = new Affiliates_Affiliate_WordPress(); return $IXAP324->edit( $_GET['affiliate_id'] ); } break; case 'remove' : if ( isset( $_GET['affiliate_id'] ) ) { return affiliates_admin_affiliates_remove( $_GET['affiliate_id'] ); } break; case 'add-attribute' : $IXAP325 = new Affiliates_Attributes_WordPress(); if ( isset( $_GET['affiliate_id'] ) ) { return $IXAP325->add( $_GET['affiliate_id' ] ); } break; case 'edit-attribute' : $IXAP325 = new Affiliates_Attributes_WordPress(); if ( isset( $_GET['affiliate_id'] ) && isset( $_GET['attr_key'] ) ) { return $IXAP325->edit( $_GET['affiliate_id' ], $_GET['attr_key'] ); } break; case 'remove-attribute' : $IXAP325 = new Affiliates_Attributes_WordPress(); if ( isset( $_GET['affiliate_id'] ) && isset( $_GET['attr_key'] ) ) { return $IXAP325->remove( $_GET['affiliate_id' ], $_GET['attr_key'] ); } break; case 'add-relation' : break; case 'edit-relation' : break; case 'remove-relation' : break; } } if ( isset( $_POST['clear_filters'] ) || isset( $_POST['submitted'] ) ) { if ( !wp_verify_nonce( $_POST[AFFILIATES_ADMIN_AFFILIATES_FILTER_NONCE], plugin_basename( __FILE__ ) ) ) { wp_die( __( 'Access denied.', AFFILIATES_PRO_PLUGIN_DOMAIN ) ); } } $IXAP31 = $affiliates_options->get_option( 'affiliates_from_date', null ); $IXAP32 = null; $IXAP33 = $affiliates_options->get_option( 'affiliates_thru_date', null ); $IXAP34 = null; $IXAP38 = $affiliates_options->get_option( 'affiliates_affiliate_id', null ); $IXAP39 = $affiliates_options->get_option( 'affiliates_affiliate_name', null ); $IXAP326 = $affiliates_options->get_option( 'affiliates_affiliate_email', null ); $IXAP40 = $affiliates_options->get_option( 'affiliates_affiliate_user_login', null ); $IXAP269 = $affiliates_options->get_option( 'affiliates_show_deleted', false ); $IXAP270 = $affiliates_options->get_option( 'affiliates_show_inoperative', false ); $IXAP210 = $affiliates_options->get_option( 'affiliates_show_totals', true ); if ( isset( $_POST['clear_filters'] ) ) { $affiliates_options->delete_option( 'affiliates_from_date' ); $affiliates_options->delete_option( 'affiliates_thru_date' ); $affiliates_options->delete_option( 'affiliates_affiliate_id' ); $affiliates_options->delete_option( 'affiliates_affiliate_name' ); $affiliates_options->delete_option( 'affiliates_affiliate_email' ); $affiliates_options->delete_option( 'affiliates_affiliate_user_login' ); $affiliates_options->delete_option( 'affiliates_show_deleted' ); $affiliates_options->delete_option( 'affiliates_show_inoperative' ); $affiliates_options->delete_option( 'affiliates_show_totals' ); $IXAP31 = null; $IXAP32 = null; $IXAP33 = null; $IXAP34 = null; $IXAP38 = null; $IXAP39 = null; $IXAP326 = null; $IXAP40 = null; $IXAP269 = false; $IXAP270 = false; $IXAP210 = true; } else if ( isset( $_POST['submitted'] ) ) { if ( !empty( $_POST['affiliate_name'] ) ) { $IXAP39 = trim( $_POST['affiliate_name'] ); if ( strlen( $IXAP39 ) > 0 ) { $affiliates_options->update_option( 'affiliates_affiliate_name', $IXAP39 ); } else { $IXAP39 = null; $affiliates_options->delete_option( 'affiliates_affiliate_name' ); } } else { $IXAP39 = null; $affiliates_options->delete_option( 'affiliates_affiliate_name' ); } if ( !empty( $_POST['affiliate_email'] ) ) { $IXAP326 = trim( $_POST['affiliate_email'] ); if ( strlen( $IXAP326 ) > 0 ) { $affiliates_options->update_option( 'affiliates_affiliate_email', $IXAP326 ); } else { $IXAP326 = null; $affiliates_options->delete_option( 'affiliates_affiliate_email' ); } } else { $IXAP326 = null; $affiliates_options->delete_option( 'affiliates_affiliate_email' ); } if ( !empty( $_POST['affiliate_user_login'] ) ) { $IXAP40 = trim( $_POST['affiliate_user_login'] ); if ( strlen( $IXAP40 ) > 0 ) { $affiliates_options->update_option( 'affiliates_affiliate_user_login', $IXAP40 ); } else { $IXAP40 = null; $affiliates_options->delete_option( 'affiliates_affiliate_user_login' ); } } else { $IXAP40 = null; $affiliates_options->delete_option( 'affiliates_affiliate_user_login' ); } $IXAP269 = isset( $_POST['show_deleted'] ); $affiliates_options->update_option( 'affiliates_show_deleted', $IXAP269 ); $IXAP270 = isset( $_POST['show_inoperative'] ); $affiliates_options->update_option( 'affiliates_show_inoperative', $IXAP270 ); $IXAP210 = isset( $_POST['show_totals'] ); $affiliates_options->update_option( 'affiliates_show_totals', $IXAP210 ); if ( !empty( $_POST['from_date'] ) ) { $IXAP31 = date( 'Y-m-d', strtotime( $_POST['from_date'] ) ); $affiliates_options->update_option( 'affiliates_from_date', $IXAP31 ); } else { $affiliates_options->delete_option( 'affiliates_from_date' ); } if ( !empty( $_POST['thru_date'] ) ) { $IXAP33 = date( 'Y-m-d', strtotime( $_POST['thru_date'] ) ); $affiliates_options->update_option( 'affiliates_thru_date', $IXAP33 ); } else { $affiliates_options->delete_option( 'affiliates_thru_date' ); } if ( $IXAP31 && $IXAP33 ) { if ( strtotime( $IXAP31 ) > strtotime( $IXAP33 ) ) { $IXAP33 = null; $affiliates_options->delete_option( 'affiliates_thru_date' ); } } if ( $IXAP31 ) { $IXAP32 = DateHelper::u2s( $IXAP31 ); } if ( $IXAP33 ) { $IXAP34 = DateHelper::u2s( $IXAP33, 24*3600 ); } if ( !empty( $_POST['affiliate_id'] ) ) { $IXAP38 = affiliates_check_affiliate_id( $_POST['affiliate_id'] ); if ( $IXAP38 ) { $affiliates_options->update_option( 'affiliates_affiliate_id', $IXAP38 ); } } else if ( isset( $_POST['affiliate_id'] ) ) { $IXAP38 = null; $affiliates_options->delete_option( 'affiliates_affiliate_id' ); } } if ( isset( $_POST['row_count'] ) ) { if ( !wp_verify_nonce( $_POST[AFFILIATES_ADMIN_AFFILIATES_NONCE_1], plugin_basename( __FILE__ ) ) ) { wp_die( __( 'Access denied.', AFFILIATES_PRO_PLUGIN_DOMAIN ) ); } } if ( isset( $_POST['paged'] ) ) { if ( !wp_verify_nonce( $_POST[AFFILIATES_ADMIN_AFFILIATES_NONCE_2], plugin_basename( __FILE__ ) ) ) { wp_die( __( 'Access denied.', AFFILIATES_PRO_PLUGIN_DOMAIN ) ); } } $IXAP66 = ( is_ssl() ? 'https://' : 'http://' ) . $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI']; $IXAP66 = remove_query_arg( 'paged', $IXAP66 ); $IXAP66 = remove_query_arg( 'action', $IXAP66 ); $IXAP66 = remove_query_arg( 'affiliate_id', $IXAP66 ); $IXAP43 = _affiliates_get_tablename( 'affiliates' ); $IXAP44 = _affiliates_get_tablename( 'affiliates_users' ); $IXAP58 .= '<div class="manage-affiliates">' . '<div>' . '<h2>' . __( 'Manage Affiliates', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</h2>' . '</div>'; $IXAP58 .= '<div class="manage">' . "<a title='" . __( 'Click to add a new affiliate', AFFILIATES_PRO_PLUGIN_DOMAIN ) . "' class='button add' href='" . esc_url( $IXAP66 ) . "&action=add'><img class='icon' alt='" . __( 'Add', AFFILIATES_PRO_PLUGIN_DOMAIN) . "' src='". AFFILIATES_PRO_PLUGIN_URL ."images/add.png'/><span class='label'>" . __( 'New Affiliate', AFFILIATES_PRO_PLUGIN_DOMAIN) . "</span></a>" . '</div>'; $IXAP178 = isset( $_POST['row_count'] ) ? intval( $_POST['row_count'] ) : 0; if ($IXAP178 <= 0) { $IXAP178 = $affiliates_options->get_option( 'affiliates_per_page', AFFILIATES_AFFILIATES_PER_PAGE ); } else { $affiliates_options->update_option('affiliates_per_page', $IXAP178 ); } $IXAP180 = isset( $_GET['offset'] ) ? intval( $_GET['offset'] ) : 0; if ( $IXAP180 < 0 ) { $IXAP180 = 0; } $IXAP181 = isset( $_GET['paged'] ) ? intval( $_GET['paged'] ) : 0; if ( $IXAP181 < 0 ) { $IXAP181 = 0; } $IXAP41 = isset( $_GET['orderby'] ) ? $_GET['orderby'] : null; switch ( $IXAP41 ) { case 'from_date' : case 'thru_date' : case 'email' : case 'affiliate_id' : case 'name' : case 'user_login' : break; default: $IXAP41 = 'name'; } $IXAP42 = isset( $_GET['order'] ) ? $_GET['order'] : null; switch ( $IXAP42 ) { case 'asc' : case 'ASC' : $IXAP182 = 'DESC'; break; case 'desc' : case 'DESC' : $IXAP182 = 'ASC'; break; default: $IXAP42 = 'ASC'; $IXAP182 = 'DESC'; } $IXAP47 = array( " 1=%d " ); $IXAP48 = array( 1 ); if ( $IXAP38 ) { $IXAP47[] = " $IXAP43.affiliate_id = %d "; $IXAP48[] = $IXAP38; } if ( $IXAP39 ) { $IXAP47[] = " $IXAP43.name LIKE '%%%s%%' "; $IXAP48[] = $IXAP39; } if ( $IXAP326 ) { $IXAP47[] = " $IXAP43.email LIKE '%%%s%%' "; $IXAP48[] = $IXAP326; } if ( $IXAP40 ) { $IXAP47[] = " $wpdb->users.user_login LIKE '%%%s%%' "; $IXAP48[] = $IXAP40; } if ( !$IXAP269 ) { $IXAP47[] = " $IXAP43.status = %s "; $IXAP48[] = 'active'; } if ( !$IXAP270 ) { $IXAP47[] = " $IXAP43.from_date <= %s AND ( $IXAP43.thru_date IS NULL OR $IXAP43.thru_date >= %s ) "; $IXAP48[] = $IXAP97; $IXAP48[] = $IXAP97; } if ( $IXAP32 && $IXAP34 ) { $IXAP47[] = " $IXAP43.from_date >= %s AND ( $IXAP43.thru_date IS NULL OR $IXAP43.thru_date < %s ) "; $IXAP48[] = $IXAP32; $IXAP48[] = $IXAP34; } else if ( $IXAP32 ) { $IXAP47[] = " $IXAP43.from_date >= %s "; $IXAP48[] = $IXAP32; } else if ( $IXAP34 ) { $IXAP47[] = " $IXAP43.thru_date < %s "; $IXAP48[] = $IXAP34; } if ( !empty( $IXAP47 ) ) { $IXAP47 = " WHERE " . implode( " AND ", $IXAP47 ); } else { $IXAP47 = ''; } $IXAP188 = $wpdb->prepare( "SELECT COUNT(*) FROM $IXAP43 LEFT JOIN $IXAP44 ON $IXAP43.affiliate_id = $IXAP44.affiliate_id LEFT JOIN $wpdb->users on $IXAP44.user_id = $wpdb->users.ID $IXAP47", $IXAP48 ); $IXAP189 = $wpdb->get_var( $IXAP188 ); if ( $IXAP189 > $IXAP178 ) { $IXAP190 = true; } else { $IXAP190 = false; } $IXAP18 = ceil ( $IXAP189 / $IXAP178 ); if ( $IXAP181 > $IXAP18 ) { $IXAP181 = $IXAP18; } if ( $IXAP181 != 0 ) { $IXAP180 = ( $IXAP181 - 1 ) * $IXAP178; } $IXAP95 = $wpdb->prepare( "SELECT $IXAP43.*, $wpdb->users.* FROM $IXAP43 LEFT JOIN $IXAP44 ON $IXAP43.affiliate_id = $IXAP44.affiliate_id LEFT JOIN $wpdb->users on $IXAP44.user_id = $wpdb->users.ID $IXAP47 ORDER BY $IXAP41 $IXAP42 LIMIT $IXAP178 OFFSET $IXAP180", $IXAP48 ); $IXAP51 = $wpdb->get_results( $IXAP95, OBJECT ); $IXAP72 = array( 'affiliate_id' => __( 'Id', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'name' => __( 'Affiliate', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'email' => __( 'Email', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'user_login' => __( 'Username', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'from_date' => __( 'From', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'thru_date' => __( 'Until', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'edit' => __( 'Edit', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'remove' => __( 'Remove', AFFILIATES_PRO_PLUGIN_DOMAIN ), 'links' => __( 'Links', AFFILIATES_PRO_PLUGIN_DOMAIN ), ); $IXAP58 .= '<div class="affiliates-overview">'; $IXAP58 .= '<div class="filters">' . '<label class="description" for="setfilters">' . __( 'Filters', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</label>' . '<form id="setfilters" action="" method="post">' . '<div class="filter-section">' . '<label class="affiliate-id-filter">' . __( 'Affiliate Id', AFFILIATES_PRO_PLUGIN_DOMAIN ) . ' ' . '<input class="affiliate-id-filter" name="affiliate_id" type="text" value="' . esc_attr( $IXAP38 ) . '"/>' . '</label>' . ' ' . '<label class="affiliate-name-filter">' . __( 'Affiliate Name', AFFILIATES_PRO_PLUGIN_DOMAIN ) . ' ' . '<input class="affiliate-name-filter" name="affiliate_name" type="text" value="' . $IXAP39 . '"/>' . '</label>' . ' ' . '<label class="affiliate-email-filter">' . __( 'Affiliate Email', AFFILIATES_PRO_PLUGIN_DOMAIN ) . ' ' . '<input class="affiliate-email-filter" name="affiliate_email" type="text" value="' . $IXAP326 . '"/>' . '</label>' . ' ' . '<label class="affiliate-user-login-filter">' . __( 'Affiliate Username', AFFILIATES_PRO_PLUGIN_DOMAIN ) . ' ' . '<input class="affiliate-user-login-filter" name="affiliate_user_login" type="text" value="' . $IXAP40 . '" />' . '</label>' . '</div>' . '<div class="filter-section">' . '<label class="from-date-filter">' . __( 'From', AFFILIATES_PRO_PLUGIN_DOMAIN ) . ' ' . '<input class="datefield from-date-filter" name="from_date" type="text" value="' . esc_attr( $IXAP31 ) . '"/>'. '</label>' . ' ' . '<label class="thru-date-filter">' . __( 'Until', AFFILIATES_PRO_PLUGIN_DOMAIN ) . ' ' . '<input class="datefield thru-date-filter" name="thru_date" type="text" class="datefield" value="' . esc_attr( $IXAP33 ) . '"/>'. '</label>' . ' ' . '<label class="show-inoperative-filter">' . '<input class="show-inoperative-filter" name="show_inoperative" type="checkbox" ' . ( $IXAP270 ? 'checked="checked"' : '' ) . '/>' . ' ' . __( 'Include inoperative affiliates', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</label>' . ' ' . '<label class="show-deleted-filter">' . '<input class="show-deleted-filter" name="show_deleted" type="checkbox" ' . ( $IXAP269 ? 'checked="checked"' : '' ) . '/>' . ' ' . __( 'Include removed affiliates', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</label>' . ' ' . '<label class="show-totals-filter">' . '<input class="show-totals-filter" name="show_totals" type="checkbox" ' . ( $IXAP210 ? 'checked="checked"' : '' ) . '/>' . ' ' . __( 'Show accumulated referral totals', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</label>' . '</div>' . '<div class="filter-buttons">' . wp_nonce_field( plugin_basename( __FILE__ ), AFFILIATES_ADMIN_AFFILIATES_FILTER_NONCE, true, false ) . '<input class="button" type="submit" value="' . __( 'Apply', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '"/>' . '<input class="button" type="submit" name="clear_filters" value="' . __( 'Clear', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '"/>' . '<input type="hidden" value="submitted" name="submitted"/>' . '</div>' . '</form>' . '</div>'; $IXAP58 .= '
			<div class="page-options">
				<form id="setrowcount" action="" method="post">
					<div>
						<label for="row_count">' . __('Results per page', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</label>' . '<input name="row_count" type="text" size="2" value="' . esc_attr( $IXAP178 ) .'" />
						' . wp_nonce_field( plugin_basename( __FILE__ ), AFFILIATES_ADMIN_AFFILIATES_NONCE_1, true, false ) . '
						<input class="button" type="submit" value="' . __( 'Apply', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '"/>
					</div>
				</form>
			</div>
			'; if ( $IXAP190 ) { $IXAP191 = new Affiliates_Pagination($IXAP189, null, $IXAP178); $IXAP58 .= '<form id="posts-filter" method="post" action="">'; $IXAP58 .= '<div>'; $IXAP58 .= wp_nonce_field( plugin_basename( __FILE__ ), AFFILIATES_ADMIN_AFFILIATES_NONCE_2, true, false ); $IXAP58 .= '</div>'; $IXAP58 .= '<div class="tablenav top">'; $IXAP58 .= $IXAP191->pagination( 'top' ); $IXAP58 .= '</div>'; $IXAP58 .= '</form>'; } $IXAP58 .= '
			<table id="" class="wp-list-table widefat fixed" cellspacing="0">
			<thead>
				<tr>
				'; foreach ( $IXAP72 as $IXAP74 => $IXAP75 ) { $IXAP101 = array( 'orderby' => $IXAP74, 'order' => $IXAP182 ); $IXAP139 = $IXAP74; if ( !in_array($IXAP74, array( 'edit', 'remove', 'links' ) ) ) { if ( strcmp( $IXAP74, $IXAP41 ) == 0 ) { $IXAP198 = strtolower( $IXAP42 ); $IXAP139 = "$IXAP74 manage-column sorted $IXAP198"; } else { $IXAP139 = "$IXAP74 manage-column sortable"; } $IXAP75 = '<a href="' . esc_url( add_query_arg( $IXAP101, $IXAP66 ) ) . '"><span>' . $IXAP75 . '</span><span class="sorting-indicator"></span></a>'; } $IXAP58 .= "<th scope='col' class='$IXAP139'>$IXAP75</th>"; } $IXAP58 .= '</tr>
			</thead>
			<tbody>
			'; if ( count( $IXAP51 ) > 0 ) { for ( $IXAP76 = 0; $IXAP76 < count( $IXAP51 ); $IXAP76++ ) { $IXAP15 = $IXAP51[$IXAP76]; $name_suffix = ''; $IXAP276 = ''; if ( $IXAP277 = ( strcmp( $IXAP15->status, 'deleted' ) == 0 ) ) { $IXAP276 = ' deleted '; $name_suffix .= " " . __( '(removed)', AFFILIATES_PRO_PLUGIN_DOMAIN ); } $IXAP278 = ''; if ( $IXAP279 = ! ( ( $IXAP15->from_date <= $IXAP97 ) && ( $IXAP15->thru_date == null || $IXAP15->thru_date >= $IXAP97 ) ) ) { $IXAP278 = ' inoperative '; $name_suffix .= " " . __( '(inoperative)', AFFILIATES_PRO_PLUGIN_DOMAIN ); } $IXAP58 .= '<tr class="' . $IXAP276 . $IXAP278 . ( $IXAP76 % 2 == 0 ? 'even' : 'odd' ) . '">'; $IXAP58 .= "<td class='affiliate-id'>"; if ( affiliates_encode_affiliate_id( $IXAP15->affiliate_id ) != $IXAP15->affiliate_id ) { $IXAP58 .= '<span class="encoded-hint" title="' . affiliates_encode_affiliate_id( $IXAP15->affiliate_id ) . '">' . $IXAP15->affiliate_id . '</span>'; } else { $IXAP58 .= $IXAP15->affiliate_id; } $IXAP58 .= "</td>"; $IXAP58 .= "<td class='affiliate-name'>" . stripslashes( wp_filter_nohtml_kses( $IXAP15->name ) ) . $name_suffix . "</td>"; $IXAP58 .= "<td class='affiliate-email'>" . $IXAP15->email; if ( isset( $IXAP15->email ) && isset( $IXAP15->user_email ) && strcmp( $IXAP15->email, $IXAP15->user_email ) !== 0 ) { $IXAP58 .= '<span title="' . sprintf( __( 'There are different email addresses on record for the affiliate and the associated user. This might be ok, but if in doubt please check. The email address on file for the user is %s', AFFILIATES_PRO_PLUGIN_DOMAIN ), $IXAP15->user_email ) . '" class="warning"> [&nbsp;!&nbsp]</span>'; } $IXAP58 .= "</td>"; $IXAP58 .= "<td class='affiliate-user-login'>"; if ( !empty( $IXAP15->ID ) ) { if ( current_user_can( 'edit_user', $IXAP15->ID ) ) { $IXAP58 .= '<a target="_blank" href="' . esc_url( "user-edit.php?user_id=$IXAP15->ID" ) . '">' . $IXAP15->user_login . '</a>'; } else { $IXAP58 .= $IXAP15->user_login; } } $IXAP58 .= "</td>"; $IXAP58 .= "<td class='from-date'>$IXAP15->from_date</td>"; $IXAP58 .= "<td class='thru-date'>$IXAP15->thru_date</td>"; $IXAP58 .= "<td class='edit'><a href='" . esc_url( add_query_arg( 'paged', $IXAP181, $IXAP66 ) ) . "&action=edit&affiliate_id=" . $IXAP15->affiliate_id . "' alt='" . __( 'Edit', AFFILIATES_PRO_PLUGIN_DOMAIN) . "'><img src='". AFFILIATES_PRO_PLUGIN_URL ."images/edit.png'/></a></td>"; $IXAP58 .= "<td class='remove'>" . ( !$IXAP277 && ( !isset( $IXAP15->type ) || ( $IXAP15->type != AFFILIATES_DIRECT_TYPE ) ) ? "<a href='" . esc_url( $IXAP66 ) . "&action=remove&affiliate_id=" . $IXAP15->affiliate_id . "' alt='" . __( 'Remove', AFFILIATES_PRO_PLUGIN_DOMAIN) . "'><img src='". AFFILIATES_PRO_PLUGIN_URL ."images/remove.png'/></a>" : "" ) . "</td>"; $IXAP58 .= "<td class='links'>"; $IXAP145 = affiliates_encode_affiliate_id( $IXAP15->affiliate_id ); $IXAP58 .= __( 'Link', AFFILIATES_PRO_PLUGIN_DOMAIN ) . ': ' . '<span class="affiliate-link">' . get_bloginfo('url') . '?' . $IXAP147 . '=' . $IXAP145 . '</span>' . '<br/>' . __( 'URL Parameter', AFFILIATES_PRO_PLUGIN_DOMAIN ) . ': ' . '<span class="affiliate-link-param">' . '?' . $IXAP147 . '=' . $IXAP145 . '</span>'; $IXAP58 .= "</td>"; $IXAP58 .= '</tr>'; if ( $IXAP210 ) { $IXAP58 .= '<tr class="' . $IXAP276 . $IXAP278 . ( $IXAP76 % 2 == 0 ? 'even' : 'odd' ) . '">'; $IXAP230 = array(); $IXAP230[AFFILIATES_REFERRAL_STATUS_CLOSED] = Affiliates_Shortcodes::get_total( $IXAP15->affiliate_id, null, null, AFFILIATES_REFERRAL_STATUS_CLOSED ); $IXAP230[AFFILIATES_REFERRAL_STATUS_ACCEPTED] = Affiliates_Shortcodes::get_total( $IXAP15->affiliate_id, null, null, AFFILIATES_REFERRAL_STATUS_ACCEPTED ); $IXAP230[AFFILIATES_REFERRAL_STATUS_PENDING] = Affiliates_Shortcodes::get_total( $IXAP15->affiliate_id, null, null, AFFILIATES_REFERRAL_STATUS_PENDING ); $IXAP230[AFFILIATES_REFERRAL_STATUS_REJECTED] = Affiliates_Shortcodes::get_total( $IXAP15->affiliate_id, null, null, AFFILIATES_REFERRAL_STATUS_REJECTED ); $IXAP58 .= '<td colspan="' . count( $IXAP72 ) . '">'; $IXAP58 .= '<table class="affiliate-referral-totals">'; $IXAP58 .= '<thead>'; $IXAP58 .= '<tr>'; foreach( $IXAP230 as $IXAP232 => $IXAP220 ) { if ( $IXAP220 ) { $IXAP58 .= '<th>'; $IXAP58 .= '<strong>'; switch( $IXAP232 ) { case AFFILIATES_REFERRAL_STATUS_CLOSED : $IXAP58 .= sprintf( __( '<span style="cursor:help" title="%s">Closed</span>', AFFILIATES_PRO_PLUGIN_DOMAIN ), esc_attr( __( 'Accumulated total for closed referrals (commissions paid).', AFFILIATES_PRO_PLUGIN_DOMAIN ) ) ); break; case AFFILIATES_REFERRAL_STATUS_ACCEPTED : $IXAP58 .= sprintf( __( '<span style="cursor:help" title="%s">Accepted</span>', AFFILIATES_PRO_PLUGIN_DOMAIN ), esc_attr( __( 'Accumulated total for accepted referrals (commissions unpaid).', AFFILIATES_PRO_PLUGIN_DOMAIN ) ) ); break; case AFFILIATES_REFERRAL_STATUS_PENDING : $IXAP58 .= sprintf( __( '<span style="cursor:help" title="%s">Pending</span>', AFFILIATES_PRO_PLUGIN_DOMAIN ), esc_attr( __( 'Accumulated total for pending referrals.', AFFILIATES_PRO_PLUGIN_DOMAIN ) ) ); break; case AFFILIATES_REFERRAL_STATUS_REJECTED : $IXAP58 .= sprintf( __( '<span style="cursor:help" title="%s">Rejected</span>', AFFILIATES_PRO_PLUGIN_DOMAIN ), esc_attr( __( 'Accumulated total for rejected referrals.', AFFILIATES_PRO_PLUGIN_DOMAIN ) ) ); break; } $IXAP58 .= '</strong>'; $IXAP58 .= '</th>'; } } $IXAP58 .= '</thead>'; $IXAP58 .= '</tr>'; $IXAP58 .= '<tbody>'; $IXAP58 .= '<tr>'; foreach( $IXAP230 as $IXAP232 => $IXAP220 ) { if ( $IXAP220 ) { $IXAP58 .= '<td>'; $IXAP58 .= '<ul>'; foreach( $IXAP220 as $IXAP275 => $IXAP23 ) { $IXAP58 .= '<li>'; $IXAP58 .= sprintf( __( '%1$s %2$s', AFFILIATES_PRO_PLUGIN_DOMAIN ), $IXAP275, $IXAP23 ); $IXAP58 .= '</li>'; } $IXAP58 .= '</ul>'; $IXAP58 .= '</td>'; } } $IXAP58 .= '</tr>'; $IXAP58 .= '<tbody>'; $IXAP58 .= '</table>'; $IXAP58 .= '</td>'; $IXAP58 .= '</tr>'; } } } else { $IXAP58 .= '<tr><td colspan="' . count( $IXAP72 ) . '">' . __('There are no results.', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</td></tr>'; } $IXAP58 .= '</tbody>'; $IXAP58 .= '</table>'; if ( $IXAP190 ) { $IXAP191 = new Affiliates_Pagination($IXAP189, null, $IXAP178); $IXAP58 .= '<div class="tablenav bottom">'; $IXAP58 .= $IXAP191->pagination( 'bottom' ); $IXAP58 .= '</div>'; } $IXAP58 .= '</div>'; $IXAP58 .= '</div>'; echo $IXAP58; affiliates_footer(); } }